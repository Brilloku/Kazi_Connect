{"ast":null,"code":"import axios from'axios';import{toast}from'react-toastify';import{supabase}from'./supabase';console.log('API URL:',process.env.REACT_APP_API_URL||'https://kazi-connect.onrender.com/api');const axiosInstance=axios.create({baseURL:process.env.REACT_APP_API_URL||'https://kazi-connect.onrender.com/api',headers:{'Content-Type':'application/json'}});// Log all requests in development\naxiosInstance.interceptors.request.use(request=>{console.log('Starting Request:',{method:request.method,url:request.url,baseURL:request.baseURL});return request;});// Request interceptor to add Supabase JWT token\naxiosInstance.interceptors.request.use(async config=>{const{data:{session}}=await supabase.auth.getSession();if(session!==null&&session!==void 0&&session.access_token){config.headers.Authorization=\"Bearer \".concat(session.access_token);}return config;},error=>{return Promise.reject(error);});// Response interceptor to handle errors\naxiosInstance.interceptors.response.use(response=>response,error=>{var _error$response$data;console.error('API Error:',error);if(error.response){// Handle specific HTTP errors\nswitch(error.response.status){case 401:case 403:// Sign out user on auth errors\nsupabase.auth.signOut();// Only redirect if we're not already on the login page\nif(!window.location.pathname.includes('/login')){toast.error('Session expired. Please login again.');window.location.href='/login';}break;default:const message=((_error$response$data=error.response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Something went wrong';toast.error(message);}}else if(error.request){// Request made but no response received\ntoast.error('No response from server. Please try again.');}else{// Something else happened\ntoast.error('An error occurred. Please try again.');}return Promise.reject(error);});export default axiosInstance;","map":{"version":3,"names":["axios","toast","supabase","console","log","process","env","REACT_APP_API_URL","axiosInstance","create","baseURL","headers","interceptors","request","use","method","url","config","data","session","auth","getSession","access_token","Authorization","concat","error","Promise","reject","response","_error$response$data","status","signOut","window","location","pathname","includes","href","message"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/utils/axios.js"],"sourcesContent":["import axios from 'axios';\r\nimport { toast } from 'react-toastify';\r\nimport { supabase } from './supabase';\r\n\r\nconsole.log('API URL:', process.env.REACT_APP_API_URL || 'https://kazi-connect.onrender.com/api');\r\n\r\nconst axiosInstance = axios.create({\r\n  baseURL: process.env.REACT_APP_API_URL || 'https://kazi-connect.onrender.com/api',\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\n\r\n// Log all requests in development\r\naxiosInstance.interceptors.request.use(request => {\r\n  console.log('Starting Request:', {\r\n    method: request.method,\r\n    url: request.url,\r\n    baseURL: request.baseURL\r\n  });\r\n  return request;\r\n});\r\n\r\n// Request interceptor to add Supabase JWT token\r\naxiosInstance.interceptors.request.use(\r\n  async (config) => {\r\n    const { data: { session } } = await supabase.auth.getSession();\r\n    if (session?.access_token) {\r\n      config.headers.Authorization = `Bearer ${session.access_token}`;\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// Response interceptor to handle errors\r\naxiosInstance.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    console.error('API Error:', error);\r\n\r\n    if (error.response) {\r\n      // Handle specific HTTP errors\r\n      switch (error.response.status) {\r\n        case 401:\r\n        case 403:\r\n          // Sign out user on auth errors\r\n          supabase.auth.signOut();\r\n          // Only redirect if we're not already on the login page\r\n          if (!window.location.pathname.includes('/login')) {\r\n            toast.error('Session expired. Please login again.');\r\n            window.location.href = '/login';\r\n          }\r\n          break;\r\n        default:\r\n          const message = error.response.data?.error || 'Something went wrong';\r\n          toast.error(message);\r\n      }\r\n    } else if (error.request) {\r\n      // Request made but no response received\r\n      toast.error('No response from server. Please try again.');\r\n    } else {\r\n      // Something else happened\r\n      toast.error('An error occurred. Please try again.');\r\n    }\r\n\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default axiosInstance;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,KAAK,KAAQ,gBAAgB,CACtC,OAASC,QAAQ,KAAQ,YAAY,CAErCC,OAAO,CAACC,GAAG,CAAC,UAAU,CAAEC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uCAAuC,CAAC,CAEjG,KAAM,CAAAC,aAAa,CAAGR,KAAK,CAACS,MAAM,CAAC,CACjCC,OAAO,CAAEL,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uCAAuC,CACjFI,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CACF,CAAC,CAAC,CAEF;AACAH,aAAa,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CAACD,OAAO,EAAI,CAChDV,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAE,CAC/BW,MAAM,CAAEF,OAAO,CAACE,MAAM,CACtBC,GAAG,CAAEH,OAAO,CAACG,GAAG,CAChBN,OAAO,CAAEG,OAAO,CAACH,OACnB,CAAC,CAAC,CACF,MAAO,CAAAG,OAAO,CAChB,CAAC,CAAC,CAEF;AACAL,aAAa,CAACI,YAAY,CAACC,OAAO,CAACC,GAAG,CACpC,KAAO,CAAAG,MAAM,EAAK,CAChB,KAAM,CAAEC,IAAI,CAAE,CAAEC,OAAQ,CAAE,CAAC,CAAG,KAAM,CAAAjB,QAAQ,CAACkB,IAAI,CAACC,UAAU,CAAC,CAAC,CAC9D,GAAIF,OAAO,SAAPA,OAAO,WAAPA,OAAO,CAAEG,YAAY,CAAE,CACzBL,MAAM,CAACN,OAAO,CAACY,aAAa,WAAAC,MAAA,CAAaL,OAAO,CAACG,YAAY,CAAE,CACjE,CACA,MAAO,CAAAL,MAAM,CACf,CAAC,CACAQ,KAAK,EAAK,CACT,MAAO,CAAAC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAC9B,CACF,CAAC,CAED;AACAjB,aAAa,CAACI,YAAY,CAACgB,QAAQ,CAACd,GAAG,CACpCc,QAAQ,EAAKA,QAAQ,CACrBH,KAAK,EAAK,KAAAI,oBAAA,CACT1B,OAAO,CAACsB,KAAK,CAAC,YAAY,CAAEA,KAAK,CAAC,CAElC,GAAIA,KAAK,CAACG,QAAQ,CAAE,CAClB;AACA,OAAQH,KAAK,CAACG,QAAQ,CAACE,MAAM,EAC3B,IAAK,IAAG,CACR,IAAK,IAAG,CACN;AACA5B,QAAQ,CAACkB,IAAI,CAACW,OAAO,CAAC,CAAC,CACvB;AACA,GAAI,CAACC,MAAM,CAACC,QAAQ,CAACC,QAAQ,CAACC,QAAQ,CAAC,QAAQ,CAAC,CAAE,CAChDlC,KAAK,CAACwB,KAAK,CAAC,sCAAsC,CAAC,CACnDO,MAAM,CAACC,QAAQ,CAACG,IAAI,CAAG,QAAQ,CACjC,CACA,MACF,QACE,KAAM,CAAAC,OAAO,CAAG,EAAAR,oBAAA,CAAAJ,KAAK,CAACG,QAAQ,CAACV,IAAI,UAAAW,oBAAA,iBAAnBA,oBAAA,CAAqBJ,KAAK,GAAI,sBAAsB,CACpExB,KAAK,CAACwB,KAAK,CAACY,OAAO,CAAC,CACxB,CACF,CAAC,IAAM,IAAIZ,KAAK,CAACZ,OAAO,CAAE,CACxB;AACAZ,KAAK,CAACwB,KAAK,CAAC,4CAA4C,CAAC,CAC3D,CAAC,IAAM,CACL;AACAxB,KAAK,CAACwB,KAAK,CAAC,sCAAsC,CAAC,CACrD,CAEA,MAAO,CAAAC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC,CAC9B,CACF,CAAC,CAED,cAAe,CAAAjB,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}