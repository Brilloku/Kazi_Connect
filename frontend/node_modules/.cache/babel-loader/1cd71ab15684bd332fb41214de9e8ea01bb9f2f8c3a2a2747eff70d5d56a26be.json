{"ast":null,"code":"import React,{useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import{supabase}from\"../utils/supabase\";// adjust path if needed\nimport axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthCallback=()=>{const navigate=useNavigate();useEffect(()=>{const verifyEmail=async()=>{try{var _user$user_metadata,_user$user_metadata2,_user$user_metadata3,_user$user_metadata4,_user$user_metadata5;// Exchange the email verification token with Supabase\nconst{data,error}=await supabase.auth.getSession();if(error||!(data!==null&&data!==void 0&&data.session)){console.error(\"Supabase session error:\",error);navigate(\"/login?error=verification_failed\");return;}const user=data.session.user;console.log(\"Verified Supabase user:\",user);// Create MongoDB user profile\nawait axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/auth/createProfile\"),{supabase_id:user.id,email:user.email,name:(_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.name,role:(_user$user_metadata2=user.user_metadata)===null||_user$user_metadata2===void 0?void 0:_user$user_metadata2.role,location:(_user$user_metadata3=user.user_metadata)===null||_user$user_metadata3===void 0?void 0:_user$user_metadata3.location,skills:(_user$user_metadata4=user.user_metadata)===null||_user$user_metadata4===void 0?void 0:_user$user_metadata4.skills,phone:(_user$user_metadata5=user.user_metadata)===null||_user$user_metadata5===void 0?void 0:_user$user_metadata5.phone});navigate(\"/login?verified=true\");}catch(err){console.error(\"Verification error:\",err);navigate(\"/login?error=verification_failed\");}};verifyEmail();},[navigate]);return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-screen\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-lg\",children:\"Verifying your email, please wait...\"})});};export default AuthCallback;","map":{"version":3,"names":["React","useEffect","useNavigate","supabase","axios","jsx","_jsx","AuthCallback","navigate","verifyEmail","_user$user_metadata","_user$user_metadata2","_user$user_metadata3","_user$user_metadata4","_user$user_metadata5","data","error","auth","getSession","session","console","user","log","post","concat","process","env","REACT_APP_API_URL","supabase_id","id","email","name","user_metadata","role","location","skills","phone","err","className","children"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/pages/AuthCallback.js"],"sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { supabase } from \"../utils/supabase\"; // adjust path if needed\r\nimport axios from \"axios\";\r\n\r\nconst AuthCallback = () => {\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const verifyEmail = async () => {\r\n      try {\r\n        // Exchange the email verification token with Supabase\r\n        const { data, error } = await supabase.auth.getSession();\r\n\r\n        if (error || !data?.session) {\r\n          console.error(\"Supabase session error:\", error);\r\n          navigate(\"/login?error=verification_failed\");\r\n          return;\r\n        }\r\n\r\n        const user = data.session.user;\r\n        console.log(\"Verified Supabase user:\", user);\r\n\r\n        // Create MongoDB user profile\r\n        await axios.post(\r\n          `${process.env.REACT_APP_API_URL}/api/auth/createProfile`,\r\n          {\r\n            supabase_id: user.id,\r\n            email: user.email,\r\n            name: user.user_metadata?.name,\r\n            role: user.user_metadata?.role,\r\n            location: user.user_metadata?.location,\r\n            skills: user.user_metadata?.skills,\r\n            phone: user.user_metadata?.phone\r\n          }\r\n        );\r\n\r\n        navigate(\"/login?verified=true\");\r\n      } catch (err) {\r\n        console.error(\"Verification error:\", err);\r\n        navigate(\"/login?error=verification_failed\");\r\n      }\r\n    };\r\n\r\n    verifyEmail();\r\n  }, [navigate]);\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-center h-screen\">\r\n      <p className=\"text-lg\">Verifying your email, please wait...</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AuthCallback;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,KAAQ,OAAO,CACxC,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,QAAQ,KAAQ,mBAAmB,CAAE;AAC9C,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE1B,KAAM,CAAAC,YAAY,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAAC,QAAQ,CAAGN,WAAW,CAAC,CAAC,CAE9BD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAQ,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,KAAAC,mBAAA,CAAAC,oBAAA,CAAAC,oBAAA,CAAAC,oBAAA,CAAAC,oBAAA,CACF;AACA,KAAM,CAAEC,IAAI,CAAEC,KAAM,CAAC,CAAG,KAAM,CAAAb,QAAQ,CAACc,IAAI,CAACC,UAAU,CAAC,CAAC,CAExD,GAAIF,KAAK,EAAI,EAACD,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEI,OAAO,EAAE,CAC3BC,OAAO,CAACJ,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CAC/CR,QAAQ,CAAC,kCAAkC,CAAC,CAC5C,OACF,CAEA,KAAM,CAAAa,IAAI,CAAGN,IAAI,CAACI,OAAO,CAACE,IAAI,CAC9BD,OAAO,CAACE,GAAG,CAAC,yBAAyB,CAAED,IAAI,CAAC,CAE5C;AACA,KAAM,CAAAjB,KAAK,CAACmB,IAAI,IAAAC,MAAA,CACXC,OAAO,CAACC,GAAG,CAACC,iBAAiB,4BAChC,CACEC,WAAW,CAAEP,IAAI,CAACQ,EAAE,CACpBC,KAAK,CAAET,IAAI,CAACS,KAAK,CACjBC,IAAI,EAAArB,mBAAA,CAAEW,IAAI,CAACW,aAAa,UAAAtB,mBAAA,iBAAlBA,mBAAA,CAAoBqB,IAAI,CAC9BE,IAAI,EAAAtB,oBAAA,CAAEU,IAAI,CAACW,aAAa,UAAArB,oBAAA,iBAAlBA,oBAAA,CAAoBsB,IAAI,CAC9BC,QAAQ,EAAAtB,oBAAA,CAAES,IAAI,CAACW,aAAa,UAAApB,oBAAA,iBAAlBA,oBAAA,CAAoBsB,QAAQ,CACtCC,MAAM,EAAAtB,oBAAA,CAAEQ,IAAI,CAACW,aAAa,UAAAnB,oBAAA,iBAAlBA,oBAAA,CAAoBsB,MAAM,CAClCC,KAAK,EAAAtB,oBAAA,CAAEO,IAAI,CAACW,aAAa,UAAAlB,oBAAA,iBAAlBA,oBAAA,CAAoBsB,KAC7B,CACF,CAAC,CAED5B,QAAQ,CAAC,sBAAsB,CAAC,CAClC,CAAE,MAAO6B,GAAG,CAAE,CACZjB,OAAO,CAACJ,KAAK,CAAC,qBAAqB,CAAEqB,GAAG,CAAC,CACzC7B,QAAQ,CAAC,kCAAkC,CAAC,CAC9C,CACF,CAAC,CAEDC,WAAW,CAAC,CAAC,CACf,CAAC,CAAE,CAACD,QAAQ,CAAC,CAAC,CAEd,mBACEF,IAAA,QAAKgC,SAAS,CAAC,2CAA2C,CAAAC,QAAA,cACxDjC,IAAA,MAAGgC,SAAS,CAAC,SAAS,CAAAC,QAAA,CAAC,sCAAoC,CAAG,CAAC,CAC5D,CAAC,CAEV,CAAC,CAED,cAAe,CAAAhC,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}