{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate,useSearchParams}from'react-router-dom';import{toast}from'react-toastify';import{supabase}from'../utils/supabase';import{useAuth}from'../context/AuthContext';import AuthBackground from'../components/AuthBackground';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const VerifyEmail=()=>{const navigate=useNavigate();const[searchParams]=useSearchParams();// eslint-disable-line no-unused-vars\nconst{user}=useAuth();const[isLoading,setIsLoading]=useState(true);const[message,setMessage]=useState('');const[hasAttemptedVerification,setHasAttemptedVerification]=useState(false);useEffect(()=>{const createProfile=async user=>{if(hasAttemptedVerification)return;setHasAttemptedVerification(true);try{var _user$user_metadata,_user$user_metadata2,_user$user_metadata3,_user$user_metadata4,_user$user_metadata5;setMessage('Creating your profile...');const response=await fetch(\"\".concat(process.env.REACT_APP_API_URL||'https://kazi-connect.onrender.com',\"/api/auth/createProfile\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({supabase_id:user.id,email:user.email,name:(_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.name,role:(_user$user_metadata2=user.user_metadata)===null||_user$user_metadata2===void 0?void 0:_user$user_metadata2.role,location:(_user$user_metadata3=user.user_metadata)===null||_user$user_metadata3===void 0?void 0:_user$user_metadata3.location,skills:(_user$user_metadata4=user.user_metadata)===null||_user$user_metadata4===void 0?void 0:_user$user_metadata4.skills,phone:(_user$user_metadata5=user.user_metadata)===null||_user$user_metadata5===void 0?void 0:_user$user_metadata5.phone})});if(response.ok){const result=await response.json();console.log('MongoDB user profile created:',result);toast.success('Account verified successfully!');setMessage('Account verified successfully! Redirecting to dashboard...');setTimeout(()=>{navigate('/dashboard');},2000);}else{console.error('Failed to create user profile:',response.status,response.statusText);const errorText=await response.text();console.error('Error response:',errorText);setMessage('Account verification successful, but there was an issue creating your profile. Please try logging in.');setTimeout(()=>navigate('/login'),3000);}}catch(err){console.error('Error creating user profile:',err);setMessage('Account verification successful, but there was an issue creating your profile. Please try logging in.');setTimeout(()=>navigate('/login'),3000);}finally{setIsLoading(false);}};if(user){// User is logged in, check if email is verified\nif(user.email_confirmed_at){createProfile(user);}else{setMessage('Email verification is still pending. Please check your email and click the verification link.');setIsLoading(false);}}else{// Listen for auth state changes\nconst{data:{subscription}}=supabase.auth.onAuthStateChange(async(event,session)=>{var _session$user;console.log('Auth state changed in VerifyEmail:',event,session===null||session===void 0?void 0:(_session$user=session.user)===null||_session$user===void 0?void 0:_session$user.email);if(event==='SIGNED_IN'&&session!==null&&session!==void 0&&session.user){if(session.user.email_confirmed_at){createProfile(session.user);}else{setMessage('Email verification is still pending. Please check your email and click the verification link.');setIsLoading(false);}}else if(event==='SIGNED_OUT'){setMessage('Session expired. Please try logging in again.');setIsLoading(false);}});// Check initial session\nconst checkInitialSession=async()=>{const{data:{session},error}=await supabase.auth.getSession();if(error){console.error('Session check error:',error);setMessage('Unable to verify session. Please try again.');setIsLoading(false);return;}if(!session){setMessage('Waiting for email verification. Please check your email and click the verification link.');setIsLoading(false);}};checkInitialSession();return()=>subscription.unsubscribe();}},[user,navigate,hasAttemptedVerification]);return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen flex items-center justify-center p-4 bg-gray-50\",children:[/*#__PURE__*/_jsx(AuthBackground,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 relative\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Email Verification\"}),isLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Verifying your email...\"})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/login'),className:\"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors\",children:\"Go to Login\"})]})]})]});};export default VerifyEmail;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useSearchParams","toast","supabase","useAuth","AuthBackground","jsx","_jsx","jsxs","_jsxs","VerifyEmail","navigate","searchParams","user","isLoading","setIsLoading","message","setMessage","hasAttemptedVerification","setHasAttemptedVerification","createProfile","_user$user_metadata","_user$user_metadata2","_user$user_metadata3","_user$user_metadata4","_user$user_metadata5","response","fetch","concat","process","env","REACT_APP_API_URL","method","headers","body","JSON","stringify","supabase_id","id","email","name","user_metadata","role","location","skills","phone","ok","result","json","console","log","success","setTimeout","error","status","statusText","errorText","text","err","email_confirmed_at","data","subscription","auth","onAuthStateChange","event","session","_session$user","checkInitialSession","getSession","unsubscribe","className","children","onClick"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/pages/VerifyEmail.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { toast } from 'react-toastify';\r\nimport { supabase } from '../utils/supabase';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport AuthBackground from '../components/AuthBackground';\r\n\r\nconst VerifyEmail = () => {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams(); // eslint-disable-line no-unused-vars\r\n  const { user } = useAuth();\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [message, setMessage] = useState('');\r\n  const [hasAttemptedVerification, setHasAttemptedVerification] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const createProfile = async (user) => {\r\n      if (hasAttemptedVerification) return;\r\n      setHasAttemptedVerification(true);\r\n\r\n      try {\r\n        setMessage('Creating your profile...');\r\n\r\n        const response = await fetch(`${process.env.REACT_APP_API_URL || 'https://kazi-connect.onrender.com'}/api/auth/createProfile`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            supabase_id: user.id,\r\n            email: user.email,\r\n            name: user.user_metadata?.name,\r\n            role: user.user_metadata?.role,\r\n            location: user.user_metadata?.location,\r\n            skills: user.user_metadata?.skills,\r\n            phone: user.user_metadata?.phone\r\n          })\r\n        });\r\n\r\n        if (response.ok) {\r\n          const result = await response.json();\r\n          console.log('MongoDB user profile created:', result);\r\n          toast.success('Account verified successfully!');\r\n          setMessage('Account verified successfully! Redirecting to dashboard...');\r\n          setTimeout(() => {\r\n            navigate('/dashboard');\r\n          }, 2000);\r\n        } else {\r\n          console.error('Failed to create user profile:', response.status, response.statusText);\r\n          const errorText = await response.text();\r\n          console.error('Error response:', errorText);\r\n          setMessage('Account verification successful, but there was an issue creating your profile. Please try logging in.');\r\n          setTimeout(() => navigate('/login'), 3000);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error creating user profile:', err);\r\n        setMessage('Account verification successful, but there was an issue creating your profile. Please try logging in.');\r\n        setTimeout(() => navigate('/login'), 3000);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (user) {\r\n      // User is logged in, check if email is verified\r\n      if (user.email_confirmed_at) {\r\n        createProfile(user);\r\n      } else {\r\n        setMessage('Email verification is still pending. Please check your email and click the verification link.');\r\n        setIsLoading(false);\r\n      }\r\n    } else {\r\n      // Listen for auth state changes\r\n      const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n        console.log('Auth state changed in VerifyEmail:', event, session?.user?.email);\r\n\r\n        if (event === 'SIGNED_IN' && session?.user) {\r\n          if (session.user.email_confirmed_at) {\r\n            createProfile(session.user);\r\n          } else {\r\n            setMessage('Email verification is still pending. Please check your email and click the verification link.');\r\n            setIsLoading(false);\r\n          }\r\n        } else if (event === 'SIGNED_OUT') {\r\n          setMessage('Session expired. Please try logging in again.');\r\n          setIsLoading(false);\r\n        }\r\n      });\r\n\r\n      // Check initial session\r\n      const checkInitialSession = async () => {\r\n        const { data: { session }, error } = await supabase.auth.getSession();\r\n        if (error) {\r\n          console.error('Session check error:', error);\r\n          setMessage('Unable to verify session. Please try again.');\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!session) {\r\n          setMessage('Waiting for email verification. Please check your email and click the verification link.');\r\n          setIsLoading(false);\r\n        }\r\n      };\r\n\r\n      checkInitialSession();\r\n\r\n      return () => subscription.unsubscribe();\r\n    }\r\n  }, [user, navigate, hasAttemptedVerification]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gray-50\">\r\n      <AuthBackground />\r\n      <div className=\"w-full max-w-md bg-white rounded-2xl shadow-xl p-8 relative\">\r\n        <h2 className=\"text-2xl font-bold mb-4\">Email Verification</h2>\r\n        {isLoading ? (\r\n          <div className=\"text-center\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n            <p>Verifying your email...</p>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <p className=\"text-gray-600 mb-4\">{message}</p>\r\n            <button\r\n              onClick={() => navigate('/login')}\r\n              className=\"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors\"\r\n            >\r\n              Go to Login\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VerifyEmail;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}