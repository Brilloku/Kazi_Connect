{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Acer\\\\Documents\\\\Kazi_Connect\\\\frontend\\\\src\\\\components\\\\chat\\\\ChatWindow.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { toast } from 'react-toastify';\n\n// Props: taskId, currentUserMongoId, currentUserName, currentUserAvatar\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatWindow = ({\n  taskId,\n  currentUserMongoId,\n  currentUserName,\n  currentUserAvatar,\n  onClose\n}) => {\n  _s();\n  const [room, setRoom] = useState(null);\n  const [chatUser, setChatUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(true);\n  const scrollRef = useRef();\n  const subscriptionRef = useRef(null);\n  useEffect(() => {\n    let mounted = true;\n    const setup = async () => {\n      try {\n        // 1) Ensure chat_user exists (by mongo_id)\n        let {\n          data: existingUser\n        } = await supabase.from('chat_users').select('*').eq('mongo_id', currentUserMongoId).limit(1);\n        let userRow;\n        if (!existingUser || existingUser.length === 0) {\n          const {\n            data,\n            error\n          } = await supabase.from('chat_users').insert([{\n            mongo_id: currentUserMongoId,\n            name: currentUserName,\n            avatar_url: currentUserAvatar\n          }]).select().single();\n          if (error) throw error;\n          userRow = data;\n        } else {\n          userRow = existingUser[0];\n        }\n        if (!mounted) return;\n        setChatUser(userRow);\n\n        // 2) Ensure chat_room exists (task_id unique)\n        let {\n          data: existingRoom\n        } = await supabase.from('chat_rooms').select('*').eq('task_id', taskId).limit(1);\n        let roomRow;\n        if (!existingRoom || existingRoom.length === 0) {\n          const {\n            data,\n            error\n          } = await supabase.from('chat_rooms').insert([{\n            task_id: taskId\n          }]).select().single();\n          if (error) throw error;\n          roomRow = data;\n        } else {\n          roomRow = existingRoom[0];\n        }\n        if (!mounted) return;\n        setRoom(roomRow);\n\n        // 3) Load messages for this room\n        const {\n          data: msgs,\n          error: msgErr\n        } = await supabase.from('chat_messages').select(`id, message, created_at, sender_id, chat_users(name, avatar_url, mongo_id)`).eq('room_id', roomRow.id).order('created_at', {\n          ascending: true\n        });\n        if (msgErr) throw msgErr;\n        if (!mounted) return;\n        setMessages(msgs || []);\n\n        // 4) Subscribe to new messages for this room\n        const channel = supabase.channel(`room:${roomRow.id}`);\n        subscriptionRef.current = supabase.from(`chat_messages:room_id=eq.${roomRow.id}`).on('INSERT', payload => {\n          const newMsg = payload.new;\n          // fetch sender info if not present\n          setMessages(prev => [...prev, newMsg]);\n          // show notification if sender is not current user\n          if (newMsg.sender_id !== userRow.id) {\n            toast.info(`New message from ${newMsg.sender_id}`);\n          }\n          // scroll to bottom\n          setTimeout(() => {\n            var _scrollRef$current;\n            return (_scrollRef$current = scrollRef.current) === null || _scrollRef$current === void 0 ? void 0 : _scrollRef$current.scrollIntoView({\n              behavior: 'smooth'\n            });\n          }, 100);\n        }).subscribe();\n      } catch (e) {\n        console.error('Chat setup error:', e);\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n    setup();\n    return () => {\n      mounted = false;\n      // unsubscribe\n      try {\n        if (subscriptionRef.current && subscriptionRef.current.unsubscribe) {\n          subscriptionRef.current.unsubscribe();\n        }\n      } catch (e) {\n        // ignore\n      }\n    };\n  }, [taskId, currentUserMongoId]);\n  const sendMessage = async () => {\n    if (!input || !room || !chatUser) return;\n    const text = input.trim();\n    if (!text) return;\n    setInput('');\n\n    // Insert message into Supabase (will trigger realtime)\n    const {\n      error\n    } = await supabase.from('chat_messages').insert([{\n      room_id: room.id,\n      sender_id: chatUser.id,\n      message: text\n    }]);\n    if (error) {\n      console.error('Send message error:', error);\n      toast.error('Failed to send message');\n    } else {\n      // Optionally broadcast a notification\n      try {\n        await supabase.channel('notifications').send({\n          type: 'broadcast',\n          event: 'new_message',\n          payload: {\n            taskId,\n            message: text,\n            senderName: currentUserName\n          }\n        });\n      } catch (e) {\n        // non-critical\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-white rounded-lg shadow-lg\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-4 py-3 border-b flex items-center justify-between\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold\",\n          children: (currentUserName === null || currentUserName === void 0 ? void 0 : currentUserName.charAt(0)) || 'U'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm font-semibold\",\n            children: \"Chat for task\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-gray-500\",\n            children: [\"Task: \", taskId]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"text-gray-500 hover:text-gray-800\",\n          children: \"Close\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto p-4 space-y-3\",\n      children: [loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-gray-500\",\n        children: \"Loading chat\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }, this) : messages.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `flex ${m.sender_id === (chatUser === null || chatUser === void 0 ? void 0 : chatUser.id) ? 'justify-end' : 'justify-start'}`,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `max-w-[70%] p-3 rounded-xl ${m.sender_id === (chatUser === null || chatUser === void 0 ? void 0 : chatUser.id) ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm\",\n            children: m.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-gray-400 mt-1 text-right\",\n            children: new Date(m.created_at).toLocaleString()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 15\n        }, this)\n      }, m.id || Math.random(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 13\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: scrollRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-4 py-3 border-t\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          value: input,\n          onChange: e => setInput(e.target.value),\n          className: \"flex-1 p-2 border rounded-lg\",\n          placeholder: \"Write a message...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sendMessage,\n          className: \"bg-blue-600 text-white px-4 py-2 rounded-lg\",\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 139,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatWindow, \"exbq3fibpFL6JY/IKpquSBkEbic=\");\n_c = ChatWindow;\nexport default ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useEffect","useRef","useState","supabase","toast","jsxDEV","_jsxDEV","ChatWindow","taskId","currentUserMongoId","currentUserName","currentUserAvatar","onClose","_s","room","setRoom","chatUser","setChatUser","messages","setMessages","input","setInput","loading","setLoading","scrollRef","subscriptionRef","mounted","setup","data","existingUser","from","select","eq","limit","userRow","length","error","insert","mongo_id","name","avatar_url","single","existingRoom","roomRow","task_id","msgs","msgErr","id","order","ascending","channel","current","on","payload","newMsg","new","prev","sender_id","info","setTimeout","_scrollRef$current","scrollIntoView","behavior","subscribe","e","console","unsubscribe","sendMessage","text","trim","room_id","message","send","type","event","senderName","className","children","charAt","fileName","_jsxFileName","lineNumber","columnNumber","onClick","map","m","Date","created_at","toLocaleString","Math","random","ref","value","onChange","target","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/components/chat/ChatWindow.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { toast } from 'react-toastify';\r\n\r\n// Props: taskId, currentUserMongoId, currentUserName, currentUserAvatar\r\nconst ChatWindow = ({ taskId, currentUserMongoId, currentUserName, currentUserAvatar, onClose }) => {\r\n  const [room, setRoom] = useState(null);\r\n  const [chatUser, setChatUser] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const scrollRef = useRef();\r\n  const subscriptionRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    const setup = async () => {\r\n      try {\r\n        // 1) Ensure chat_user exists (by mongo_id)\r\n        let { data: existingUser } = await supabase\r\n          .from('chat_users')\r\n          .select('*')\r\n          .eq('mongo_id', currentUserMongoId)\r\n          .limit(1);\r\n\r\n        let userRow;\r\n        if (!existingUser || existingUser.length === 0) {\r\n          const { data, error } = await supabase.from('chat_users').insert([\r\n            { mongo_id: currentUserMongoId, name: currentUserName, avatar_url: currentUserAvatar }\r\n          ]).select().single();\r\n          if (error) throw error;\r\n          userRow = data;\r\n        } else {\r\n          userRow = existingUser[0];\r\n        }\r\n        if (!mounted) return;\r\n        setChatUser(userRow);\r\n\r\n        // 2) Ensure chat_room exists (task_id unique)\r\n        let { data: existingRoom } = await supabase\r\n          .from('chat_rooms')\r\n          .select('*')\r\n          .eq('task_id', taskId)\r\n          .limit(1);\r\n\r\n        let roomRow;\r\n        if (!existingRoom || existingRoom.length === 0) {\r\n          const { data, error } = await supabase.from('chat_rooms').insert([\r\n            { task_id: taskId }\r\n          ]).select().single();\r\n          if (error) throw error;\r\n          roomRow = data;\r\n        } else {\r\n          roomRow = existingRoom[0];\r\n        }\r\n        if (!mounted) return;\r\n        setRoom(roomRow);\r\n\r\n        // 3) Load messages for this room\r\n        const { data: msgs, error: msgErr } = await supabase\r\n          .from('chat_messages')\r\n          .select(`id, message, created_at, sender_id, chat_users(name, avatar_url, mongo_id)`)\r\n          .eq('room_id', roomRow.id)\r\n          .order('created_at', { ascending: true });\r\n\r\n        if (msgErr) throw msgErr;\r\n        if (!mounted) return;\r\n        setMessages(msgs || []);\r\n\r\n        // 4) Subscribe to new messages for this room\r\n        const channel = supabase.channel(`room:${roomRow.id}`);\r\n        subscriptionRef.current = supabase\r\n          .from(`chat_messages:room_id=eq.${roomRow.id}`)\r\n          .on('INSERT', payload => {\r\n            const newMsg = payload.new;\r\n            // fetch sender info if not present\r\n            setMessages(prev => [...prev, newMsg]);\r\n            // show notification if sender is not current user\r\n            if (newMsg.sender_id !== userRow.id) {\r\n              toast.info(`New message from ${newMsg.sender_id}`);\r\n            }\r\n            // scroll to bottom\r\n            setTimeout(() => scrollRef.current?.scrollIntoView({ behavior: 'smooth' }), 100);\r\n          })\r\n          .subscribe();\r\n\r\n      } catch (e) {\r\n        console.error('Chat setup error:', e);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    setup();\r\n\r\n    return () => {\r\n      mounted = false;\r\n      // unsubscribe\r\n      try {\r\n        if (subscriptionRef.current && subscriptionRef.current.unsubscribe) {\r\n          subscriptionRef.current.unsubscribe();\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    };\r\n  }, [taskId, currentUserMongoId]);\r\n\r\n  const sendMessage = async () => {\r\n    if (!input || !room || !chatUser) return;\r\n    const text = input.trim();\r\n    if (!text) return;\r\n    setInput('');\r\n\r\n    // Insert message into Supabase (will trigger realtime)\r\n    const { error } = await supabase.from('chat_messages').insert([\r\n      { room_id: room.id, sender_id: chatUser.id, message: text }\r\n    ]);\r\n\r\n    if (error) {\r\n      console.error('Send message error:', error);\r\n      toast.error('Failed to send message');\r\n    } else {\r\n      // Optionally broadcast a notification\r\n      try {\r\n        await supabase.channel('notifications').send({\r\n          type: 'broadcast',\r\n          event: 'new_message',\r\n          payload: { taskId, message: text, senderName: currentUserName }\r\n        });\r\n      } catch (e) {\r\n        // non-critical\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white rounded-lg shadow-lg\">\r\n      <div className=\"px-4 py-3 border-b flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold\">\r\n            {currentUserName?.charAt(0) || 'U'}\r\n          </div>\r\n          <div>\r\n            <div className=\"text-sm font-semibold\">Chat for task</div>\r\n            <div className=\"text-xs text-gray-500\">Task: {taskId}</div>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <button onClick={onClose} className=\"text-gray-500 hover:text-gray-800\">Close</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n        {loading ? (\r\n          <div className=\"text-center text-gray-500\">Loading chatâ€¦</div>\r\n        ) : (\r\n          messages.map((m) => (\r\n            <div key={m.id || Math.random()} className={`flex ${m.sender_id === (chatUser?.id) ? 'justify-end' : 'justify-start'}`}>\r\n              <div className={`max-w-[70%] p-3 rounded-xl ${m.sender_id === (chatUser?.id) ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'}`}>\r\n                <div className=\"text-sm\">{m.message}</div>\r\n                <div className=\"text-xs text-gray-400 mt-1 text-right\">{new Date(m.created_at).toLocaleString()}</div>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n        <div ref={scrollRef}></div>\r\n      </div>\r\n\r\n      <div className=\"px-4 py-3 border-t\">\r\n        <div className=\"flex gap-2\">\r\n          <input value={input} onChange={(e) => setInput(e.target.value)} className=\"flex-1 p-2 border rounded-lg\" placeholder=\"Write a message...\" />\r\n          <button onClick={sendMessage} className=\"bg-blue-600 text-white px-4 py-2 rounded-lg\">Send</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWindow;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}