{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Acer\\\\Documents\\\\Kazi_Connect\\\\frontend\\\\src\\\\components\\\\chat\\\\ChatWindow.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { toast } from 'react-toastify';\n\n// Props: taskId, currentUserMongoId, currentUserName, currentUserAvatar\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChatWindow = ({\n  taskId,\n  currentUserMongoId,\n  currentUserName,\n  currentUserAvatar,\n  onClose\n}) => {\n  _s();\n  const [room, setRoom] = useState(null);\n  const [chatUser, setChatUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(true);\n  const scrollRef = useRef();\n  const subscriptionRef = useRef(null);\n  useEffect(() => {\n    let mounted = true;\n    const setup = async () => {\n      try {\n        // 1) Ensure chat_user exists (by mongo_id)\n        let {\n          data: existingUser\n        } = await supabase.from('chat_users').select('*').eq('mongo_id', currentUserMongoId).limit(1);\n        let userRow;\n        if (!existingUser || existingUser.length === 0) {\n          const {\n            data,\n            error\n          } = await supabase.from('chat_users').insert([{\n            mongo_id: currentUserMongoId,\n            name: currentUserName,\n            avatar_url: currentUserAvatar\n          }]).select().single();\n          if (error) throw error;\n          userRow = data;\n        } else {\n          userRow = existingUser[0];\n        }\n        if (!mounted) return;\n        setChatUser(userRow);\n\n        // 2) Ensure chat_room exists (task_id unique)\n        let {\n          data: existingRoom\n        } = await supabase.from('chat_rooms').select('*').eq('task_id', taskId).limit(1);\n        let roomRow;\n        if (!existingRoom || existingRoom.length === 0) {\n          const {\n            data,\n            error\n          } = await supabase.from('chat_rooms').insert([{\n            task_id: taskId\n          }]).select().single();\n          if (error) throw error;\n          roomRow = data;\n        } else {\n          roomRow = existingRoom[0];\n        }\n        if (!mounted) return;\n        setRoom(roomRow);\n\n        // 3) Load messages for this room\n        const {\n          data: msgs,\n          error: msgErr\n        } = await supabase.from('chat_messages').select(`id, message, created_at, sender_id, sender_name, sender_avatar`).eq('room_id', roomRow.id).order('created_at', {\n          ascending: true\n        });\n        if (msgErr) throw msgErr;\n        if (!mounted) return;\n        setMessages(msgs || []);\n\n        // 4) Subscribe to new messages for this room using channel/postgres_changes\n        const channel = supabase.channel(`room:${roomRow.id}`);\n        channel.on('postgres_changes', {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'chat_messages',\n          filter: `room_id=eq.${roomRow.id}`\n        }, payload => {\n          const newMsg = payload.new;\n          setMessages(prev => [...prev, newMsg]);\n          // show notification if sender is not current user\n          if (newMsg.sender_id !== userRow.id) {\n            toast.info(`New message from ${newMsg.sender_name || 'Unknown'}`);\n          }\n          setTimeout(() => {\n            var _scrollRef$current;\n            return (_scrollRef$current = scrollRef.current) === null || _scrollRef$current === void 0 ? void 0 : _scrollRef$current.scrollIntoView({\n              behavior: 'smooth'\n            });\n          }, 100);\n        });\n\n        // subscribe and keep reference for cleanup\n        await channel.subscribe();\n        subscriptionRef.current = channel;\n      } catch (e) {\n        console.error('Chat setup error:', e);\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n    setup();\n    return () => {\n      mounted = false;\n      // unsubscribe\n      try {\n        if (subscriptionRef.current) {\n          // supabase v2: remove channel\n          supabase.removeChannel(subscriptionRef.current);\n        }\n      } catch (e) {\n        // ignore\n      }\n    };\n  }, [taskId, currentUserMongoId]);\n  const sendMessage = async () => {\n    if (!input || !room || !chatUser) return;\n    const text = input.trim();\n    if (!text) return;\n    setInput('');\n\n    // Insert message into Supabase (will trigger realtime)\n    const {\n      error\n    } = await supabase.from('chat_messages').insert([{\n      room_id: room.id,\n      sender_id: chatUser.id,\n      message: text,\n      sender_name: currentUserName,\n      sender_avatar: currentUserAvatar\n    }]);\n    if (error) {\n      console.error('Send message error:', error);\n      toast.error('Failed to send message');\n    } else {\n      // Optionally broadcast a notification\n      try {\n        await supabase.channel('notifications').send({\n          type: 'broadcast',\n          event: 'new_message',\n          payload: {\n            taskId,\n            message: text,\n            senderName: currentUserName\n          }\n        });\n      } catch (e) {\n        // non-critical\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-white rounded-lg shadow-lg\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-4 py-3 border-b flex items-center justify-between\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold\",\n          children: (currentUserName === null || currentUserName === void 0 ? void 0 : currentUserName.charAt(0)) || 'U'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm font-semibold\",\n            children: \"Chat for task\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-gray-500\",\n            children: [\"Task: \", taskId]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"text-gray-500 hover:text-gray-800\",\n          children: \"Close\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto p-4 space-y-3\",\n      children: [loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-gray-500\",\n        children: \"Loading chat\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 11\n      }, this) : messages.map(m => {\n        const isMe = m.sender_id === (chatUser === null || chatUser === void 0 ? void 0 : chatUser.id);\n        const senderName = m.sender_name || currentUserName;\n        const senderAvatar = m.sender_avatar || currentUserAvatar;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `flex ${isMe ? 'justify-end' : 'justify-start'}`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `max-w-[70%] p-3 rounded-xl ${isMe ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'} flex gap-3 items-start`,\n            children: [!isMe && /*#__PURE__*/_jsxDEV(\"img\", {\n              src: senderAvatar || '/favicon.ico',\n              alt: senderName,\n              className: \"w-8 h-8 rounded-full object-cover\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 171,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [!isMe && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-xs font-medium text-gray-700 mb-1\",\n                children: senderName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 174,\n                columnNumber: 31\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-sm\",\n                children: m.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 175,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-xs text-gray-400 mt-1 text-right\",\n                children: new Date(m.created_at).toLocaleString()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 17\n          }, this)\n        }, m.id || Math.random(), false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 15\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: scrollRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-4 py-3 border-t\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          value: input,\n          onChange: e => setInput(e.target.value),\n          className: \"flex-1 p-2 border rounded-lg\",\n          placeholder: \"Write a message...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sendMessage,\n          className: \"bg-blue-600 text-white px-4 py-2 rounded-lg\",\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 143,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatWindow, \"exbq3fibpFL6JY/IKpquSBkEbic=\");\n_c = ChatWindow;\nexport default ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useEffect","useRef","useState","supabase","toast","jsxDEV","_jsxDEV","ChatWindow","taskId","currentUserMongoId","currentUserName","currentUserAvatar","onClose","_s","room","setRoom","chatUser","setChatUser","messages","setMessages","input","setInput","loading","setLoading","scrollRef","subscriptionRef","mounted","setup","data","existingUser","from","select","eq","limit","userRow","length","error","insert","mongo_id","name","avatar_url","single","existingRoom","roomRow","task_id","msgs","msgErr","id","order","ascending","channel","on","event","schema","table","filter","payload","newMsg","new","prev","sender_id","info","sender_name","setTimeout","_scrollRef$current","current","scrollIntoView","behavior","subscribe","e","console","removeChannel","sendMessage","text","trim","room_id","message","sender_avatar","send","type","senderName","className","children","charAt","fileName","_jsxFileName","lineNumber","columnNumber","onClick","map","m","isMe","senderAvatar","src","alt","Date","created_at","toLocaleString","Math","random","ref","value","onChange","target","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/components/chat/ChatWindow.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { toast } from 'react-toastify';\r\n\r\n// Props: taskId, currentUserMongoId, currentUserName, currentUserAvatar\r\nconst ChatWindow = ({ taskId, currentUserMongoId, currentUserName, currentUserAvatar, onClose }) => {\r\n  const [room, setRoom] = useState(null);\r\n  const [chatUser, setChatUser] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const scrollRef = useRef();\r\n  const subscriptionRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    const setup = async () => {\r\n      try {\r\n        // 1) Ensure chat_user exists (by mongo_id)\r\n        let { data: existingUser } = await supabase\r\n          .from('chat_users')\r\n          .select('*')\r\n          .eq('mongo_id', currentUserMongoId)\r\n          .limit(1);\r\n\r\n        let userRow;\r\n        if (!existingUser || existingUser.length === 0) {\r\n          const { data, error } = await supabase.from('chat_users').insert([\r\n            { mongo_id: currentUserMongoId, name: currentUserName, avatar_url: currentUserAvatar }\r\n          ]).select().single();\r\n          if (error) throw error;\r\n          userRow = data;\r\n        } else {\r\n          userRow = existingUser[0];\r\n        }\r\n        if (!mounted) return;\r\n        setChatUser(userRow);\r\n\r\n        // 2) Ensure chat_room exists (task_id unique)\r\n        let { data: existingRoom } = await supabase\r\n          .from('chat_rooms')\r\n          .select('*')\r\n          .eq('task_id', taskId)\r\n          .limit(1);\r\n\r\n        let roomRow;\r\n        if (!existingRoom || existingRoom.length === 0) {\r\n          const { data, error } = await supabase.from('chat_rooms').insert([\r\n            { task_id: taskId }\r\n          ]).select().single();\r\n          if (error) throw error;\r\n          roomRow = data;\r\n        } else {\r\n          roomRow = existingRoom[0];\r\n        }\r\n        if (!mounted) return;\r\n        setRoom(roomRow);\r\n\r\n        // 3) Load messages for this room\r\n        const { data: msgs, error: msgErr } = await supabase\r\n          .from('chat_messages')\r\n          .select(`id, message, created_at, sender_id, sender_name, sender_avatar`)\r\n          .eq('room_id', roomRow.id)\r\n          .order('created_at', { ascending: true });\r\n\r\n        if (msgErr) throw msgErr;\r\n        if (!mounted) return;\r\n        setMessages(msgs || []);\r\n\r\n        // 4) Subscribe to new messages for this room using channel/postgres_changes\r\n        const channel = supabase.channel(`room:${roomRow.id}`);\r\n        channel.on(\r\n          'postgres_changes',\r\n          { event: 'INSERT', schema: 'public', table: 'chat_messages', filter: `room_id=eq.${roomRow.id}` },\r\n          (payload) => {\r\n            const newMsg = payload.new;\r\n            setMessages(prev => [...prev, newMsg]);\r\n            // show notification if sender is not current user\r\n            if (newMsg.sender_id !== userRow.id) {\r\n              toast.info(`New message from ${newMsg.sender_name || 'Unknown'}`);\r\n            }\r\n            setTimeout(() => scrollRef.current?.scrollIntoView({ behavior: 'smooth' }), 100);\r\n          }\r\n        );\r\n\r\n        // subscribe and keep reference for cleanup\r\n        await channel.subscribe();\r\n        subscriptionRef.current = channel;\r\n\r\n      } catch (e) {\r\n        console.error('Chat setup error:', e);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    };\r\n\r\n    setup();\r\n\r\n    return () => {\r\n      mounted = false;\r\n      // unsubscribe\r\n      try {\r\n        if (subscriptionRef.current) {\r\n          // supabase v2: remove channel\r\n          supabase.removeChannel(subscriptionRef.current);\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    };\r\n  }, [taskId, currentUserMongoId]);\r\n\r\n  const sendMessage = async () => {\r\n    if (!input || !room || !chatUser) return;\r\n    const text = input.trim();\r\n    if (!text) return;\r\n    setInput('');\r\n\r\n    // Insert message into Supabase (will trigger realtime)\r\n    const { error } = await supabase.from('chat_messages').insert([\r\n      { room_id: room.id, sender_id: chatUser.id, message: text, sender_name: currentUserName, sender_avatar: currentUserAvatar }\r\n    ]);\r\n\r\n    if (error) {\r\n      console.error('Send message error:', error);\r\n      toast.error('Failed to send message');\r\n    } else {\r\n      // Optionally broadcast a notification\r\n      try {\r\n        await supabase.channel('notifications').send({\r\n          type: 'broadcast',\r\n          event: 'new_message',\r\n          payload: { taskId, message: text, senderName: currentUserName }\r\n        });\r\n      } catch (e) {\r\n        // non-critical\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white rounded-lg shadow-lg\">\r\n      <div className=\"px-4 py-3 border-b flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold\">\r\n            {currentUserName?.charAt(0) || 'U'}\r\n          </div>\r\n          <div>\r\n            <div className=\"text-sm font-semibold\">Chat for task</div>\r\n            <div className=\"text-xs text-gray-500\">Task: {taskId}</div>\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <button onClick={onClose} className=\"text-gray-500 hover:text-gray-800\">Close</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n        {loading ? (\r\n          <div className=\"text-center text-gray-500\">Loading chatâ€¦</div>\r\n        ) : (\r\n          messages.map((m) => {\r\n            const isMe = m.sender_id === (chatUser?.id);\r\n            const senderName = m.sender_name || currentUserName;\r\n            const senderAvatar = m.sender_avatar || currentUserAvatar;\r\n            return (\r\n              <div key={m.id || Math.random()} className={`flex ${isMe ? 'justify-end' : 'justify-start'}`}>\r\n                <div className={`max-w-[70%] p-3 rounded-xl ${isMe ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'} flex gap-3 items-start`}>\r\n                  {!isMe && (\r\n                    <img src={senderAvatar || '/favicon.ico'} alt={senderName} className=\"w-8 h-8 rounded-full object-cover\" />\r\n                  )}\r\n                  <div>\r\n                    {!isMe && <div className=\"text-xs font-medium text-gray-700 mb-1\">{senderName}</div>}\r\n                    <div className=\"text-sm\">{m.message}</div>\r\n                    <div className=\"text-xs text-gray-400 mt-1 text-right\">{new Date(m.created_at).toLocaleString()}</div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })\r\n        )}\r\n        <div ref={scrollRef}></div>\r\n      </div>\r\n\r\n      <div className=\"px-4 py-3 border-t\">\r\n        <div className=\"flex gap-2\">\r\n          <input value={input} onChange={(e) => setInput(e.target.value)} className=\"flex-1 p-2 border rounded-lg\" placeholder=\"Write a message...\" />\r\n          <button onClick={sendMessage} className=\"bg-blue-600 text-white px-4 py-2 rounded-lg\">Send</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWindow;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}