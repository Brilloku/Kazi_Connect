{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Acer\\\\Documents\\\\Kazi_Connect\\\\frontend\\\\src\\\\context\\\\RealtimeContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useEffect, useMemo, useState } from 'react';\nimport { toast } from 'react-toastify';\nimport { useAuth } from './AuthContext';\nimport { subscribeToRealtimeEvents, unsubscribeRealtime } from '../utils/realtime';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const RealtimeContext = /*#__PURE__*/createContext({\n  events: [],\n  unreadCount: 0,\n  markAllRead: () => {}\n});\nexport const RealtimeProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [events, setEvents] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => {\n    if (!user) {\n      // cleanup when logged out\n      setEvents([]);\n      setUnreadCount(0);\n      return;\n    }\n\n    // subscribe for this user\n    const ch = subscribeToRealtimeEvents(user._id, record => {\n      setEvents(prev => [record, ...prev].slice(0, 50));\n      setUnreadCount(c => c + 1);\n      // show a toast notification\n      try {\n        const type = record.type || 'notification';\n        if (type === 'chat:new-message') {\n          var _record$payload;\n          // Special handling for chat messages - only show if relevant to current user\n          // For now, show all chat notifications (can be filtered later based on task ownership)\n          toast.info(`Chat: ${((_record$payload = record.payload) === null || _record$payload === void 0 ? void 0 : _record$payload.message) || 'New message'}`);\n        } else {\n          var _record$payload2;\n          const title = type.replace('task:', '').replace('-', ' ');\n          toast.info(`${title}: ${((_record$payload2 = record.payload) === null || _record$payload2 === void 0 ? void 0 : _record$payload2.message) || 'You have a new event'}`);\n        }\n      } catch (err) {\n        console.warn('Realtime toast error', err);\n      }\n    });\n    return () => {\n      if (ch) unsubscribeRealtime(ch);\n    };\n  }, [user]);\n  const markAllRead = () => {\n    setUnreadCount(0);\n  };\n  const value = useMemo(() => ({\n    events,\n    unreadCount,\n    markAllRead\n  }), [events, unreadCount]);\n  return /*#__PURE__*/_jsxDEV(RealtimeContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 5\n  }, this);\n};\n_s(RealtimeProvider, \"j251ryJPmWHLrlR7pg9rusb+gis=\", false, function () {\n  return [useAuth];\n});\n_c = RealtimeProvider;\nexport default RealtimeProvider;\nvar _c;\n$RefreshReg$(_c, \"RealtimeProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useMemo","useState","toast","useAuth","subscribeToRealtimeEvents","unsubscribeRealtime","jsxDEV","_jsxDEV","RealtimeContext","events","unreadCount","markAllRead","RealtimeProvider","children","_s","user","setEvents","setUnreadCount","ch","_id","record","prev","slice","c","type","_record$payload","info","payload","message","_record$payload2","title","replace","err","console","warn","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/context/RealtimeContext.js"],"sourcesContent":["import React, { createContext, useEffect, useMemo, useState } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { useAuth } from './AuthContext';\r\nimport { subscribeToRealtimeEvents, unsubscribeRealtime } from '../utils/realtime';\r\n\r\nexport const RealtimeContext = createContext({\r\n  events: [],\r\n  unreadCount: 0,\r\n  markAllRead: () => {},\r\n});\r\n\r\nexport const RealtimeProvider = ({ children }) => {\r\n  const { user } = useAuth();\r\n  const [events, setEvents] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!user) {\r\n      // cleanup when logged out\r\n      setEvents([]);\r\n      setUnreadCount(0);\r\n      return;\r\n    }\r\n\r\n    // subscribe for this user\r\n    const ch = subscribeToRealtimeEvents(user._id, (record) => {\r\n      setEvents(prev => [record, ...prev].slice(0, 50));\r\n      setUnreadCount(c => c + 1);\r\n      // show a toast notification\r\n      try {\r\n        const type = record.type || 'notification';\r\n        if (type === 'chat:new-message') {\r\n          // Special handling for chat messages - only show if relevant to current user\r\n          // For now, show all chat notifications (can be filtered later based on task ownership)\r\n          toast.info(`Chat: ${record.payload?.message || 'New message'}`);\r\n        } else {\r\n          const title = type.replace('task:', '').replace('-', ' ');\r\n          toast.info(`${title}: ${record.payload?.message || 'You have a new event'}`);\r\n        }\r\n      } catch (err) {\r\n        console.warn('Realtime toast error', err);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      if (ch) unsubscribeRealtime(ch);\r\n    };\r\n  }, [user]);\r\n\r\n  const markAllRead = () => {\r\n    setUnreadCount(0);\r\n  };\r\n\r\n  const value = useMemo(() => ({ events, unreadCount, markAllRead }), [events, unreadCount]);\r\n\r\n  return (\r\n    <RealtimeContext.Provider value={value}>\r\n      {children}\r\n    </RealtimeContext.Provider>\r\n  );\r\n};\r\n\r\nexport default RealtimeProvider;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}