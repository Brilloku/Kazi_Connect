{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Acer\\\\Documents\\\\Kazi_Connect\\\\frontend\\\\src\\\\context\\\\RealtimeContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useEffect, useMemo, useState } from 'react';\nimport { toast } from 'react-toastify';\nimport { useAuth } from './AuthContext';\nimport { subscribeToRealtimeEvents, unsubscribeRealtime } from '../utils/realtime';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const RealtimeContext = /*#__PURE__*/createContext({\n  events: [],\n  unreadCount: 0,\n  markAllRead: () => {}\n});\nexport const RealtimeProvider = ({\n  children\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [events, setEvents] = useState([]);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [channel, setChannel] = useState(null);\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => {\n    if (!user) {\n      // cleanup when logged out\n      if (channel) {\n        unsubscribeRealtime(channel);\n        setChannel(null);\n      }\n      setEvents([]);\n      setUnreadCount(0);\n      return;\n    }\n\n    // subscribe for this user\n    const ch = subscribeToRealtimeEvents(user._id, record => {\n      setEvents(prev => [record, ...prev].slice(0, 50));\n      setUnreadCount(c => c + 1);\n      // show a toast notification\n      try {\n        var _record$payload;\n        const type = record.type || 'notification';\n        const title = type.replace('task:', '').replace('-', ' ');\n        toast.info(`${title}: ${((_record$payload = record.payload) === null || _record$payload === void 0 ? void 0 : _record$payload.message) || 'You have a new event'}`);\n      } catch (err) {\n        console.warn('Realtime toast error', err);\n      }\n    });\n    setChannel(ch);\n    return () => {\n      if (ch) unsubscribeRealtime(ch);\n      setChannel(null);\n    };\n  }, [user]);\n  const markAllRead = () => {\n    setUnreadCount(0);\n  };\n  const value = useMemo(() => ({\n    events,\n    unreadCount,\n    markAllRead\n  }), [events, unreadCount]);\n  return /*#__PURE__*/_jsxDEV(RealtimeContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 5\n  }, this);\n};\n_s(RealtimeProvider, \"duYYpWyu1XQhZA7Np7FdcPGID4Y=\", false, function () {\n  return [useAuth];\n});\n_c = RealtimeProvider;\nexport default RealtimeProvider;\nvar _c;\n$RefreshReg$(_c, \"RealtimeProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useMemo","useState","toast","useAuth","subscribeToRealtimeEvents","unsubscribeRealtime","jsxDEV","_jsxDEV","RealtimeContext","events","unreadCount","markAllRead","RealtimeProvider","children","_s","user","setEvents","setUnreadCount","channel","setChannel","ch","_id","record","prev","slice","c","_record$payload","type","title","replace","info","payload","message","err","console","warn","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/context/RealtimeContext.js"],"sourcesContent":["import React, { createContext, useEffect, useMemo, useState } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { useAuth } from './AuthContext';\r\nimport { subscribeToRealtimeEvents, unsubscribeRealtime } from '../utils/realtime';\r\n\r\nexport const RealtimeContext = createContext({\r\n  events: [],\r\n  unreadCount: 0,\r\n  markAllRead: () => {},\r\n});\r\n\r\nexport const RealtimeProvider = ({ children }) => {\r\n  const { user } = useAuth();\r\n  const [events, setEvents] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [channel, setChannel] = useState(null);\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!user) {\r\n      // cleanup when logged out\r\n      if (channel) {\r\n        unsubscribeRealtime(channel);\r\n        setChannel(null);\r\n      }\r\n      setEvents([]);\r\n      setUnreadCount(0);\r\n      return;\r\n    }\r\n\r\n    // subscribe for this user\r\n    const ch = subscribeToRealtimeEvents(user._id, (record) => {\r\n      setEvents(prev => [record, ...prev].slice(0, 50));\r\n      setUnreadCount(c => c + 1);\r\n      // show a toast notification\r\n      try {\r\n        const type = record.type || 'notification';\r\n        const title = type.replace('task:', '').replace('-', ' ');\r\n        toast.info(`${title}: ${record.payload?.message || 'You have a new event'}`);\r\n      } catch (err) {\r\n        console.warn('Realtime toast error', err);\r\n      }\r\n    });\r\n\r\n    setChannel(ch);\r\n\r\n    return () => {\r\n      if (ch) unsubscribeRealtime(ch);\r\n      setChannel(null);\r\n    };\r\n  }, [user]);\r\n\r\n  const markAllRead = () => {\r\n    setUnreadCount(0);\r\n  };\r\n\r\n  const value = useMemo(() => ({ events, unreadCount, markAllRead }), [events, unreadCount]);\r\n\r\n  return (\r\n    <RealtimeContext.Provider value={value}>\r\n      {children}\r\n    </RealtimeContext.Provider>\r\n  );\r\n};\r\n\r\nexport default RealtimeProvider;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}