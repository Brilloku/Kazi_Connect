{"ast":null,"code":"import { supabase } from '../lib/supabase';\n\n// Subscribe to `realtime_events` table for a specific user (or global if userId is null)\n// Returns the subscription object which can be passed to `unsubscribe`.\nexport function subscribeToRealtimeEvents(userId, onEvent) {\n  // Build filter: if userId present, only events where target_user_id equals userId or null (global)\n  const filter = userId ? `target_user_id=eq.${userId}` : '';\n\n  // Use Supabase realtime subscription via channel\n  const channel = supabase.channel('realtime_events_channel');\n  const topic = `public:realtime_events`;\n  channel.on('postgres_changes', {\n    event: 'INSERT',\n    schema: 'public',\n    table: 'realtime_events'\n  }, payload => {\n    // If userId provided, allow events where target_user_id matches or is null/empty\n    const record = payload.new || payload.record || payload;\n    if (userId) {\n      const target = record.target_user_id;\n      if (target && target !== userId) return; // not for this user\n    }\n    onEvent(record);\n  }).subscribe();\n  return channel;\n}\nexport function unsubscribeRealtime(channel) {\n  if (!channel) return;\n  try {\n    supabase.removeChannel(channel);\n  } catch (err) {\n    console.warn('Error removing realtime channel', err);\n  }\n}","map":{"version":3,"names":["supabase","subscribeToRealtimeEvents","userId","onEvent","filter","channel","topic","on","event","schema","table","payload","record","new","target","target_user_id","subscribe","unsubscribeRealtime","removeChannel","err","console","warn"],"sources":["C:/Users/Acer/Documents/Kazi_Connect/frontend/src/utils/realtime.js"],"sourcesContent":["import { supabase } from '../lib/supabase';\r\n\r\n// Subscribe to `realtime_events` table for a specific user (or global if userId is null)\r\n// Returns the subscription object which can be passed to `unsubscribe`.\r\nexport function subscribeToRealtimeEvents(userId, onEvent) {\r\n  // Build filter: if userId present, only events where target_user_id equals userId or null (global)\r\n  const filter = userId ? `target_user_id=eq.${userId}` : '';\r\n\r\n  // Use Supabase realtime subscription via channel\r\n  const channel = supabase.channel('realtime_events_channel');\r\n\r\n  const topic = `public:realtime_events`;\r\n\r\n  channel.on(\r\n    'postgres_changes',\r\n    { event: 'INSERT', schema: 'public', table: 'realtime_events' },\r\n    (payload) => {\r\n      // If userId provided, allow events where target_user_id matches or is null/empty\r\n      const record = payload.new || payload.record || payload;\r\n      if (userId) {\r\n        const target = record.target_user_id;\r\n        if (target && target !== userId) return; // not for this user\r\n      }\r\n      onEvent(record);\r\n    }\r\n  ).subscribe();\r\n\r\n  return channel;\r\n}\r\n\r\nexport function unsubscribeRealtime(channel) {\r\n  if (!channel) return;\r\n  try {\r\n    supabase.removeChannel(channel);\r\n  } catch (err) {\r\n    console.warn('Error removing realtime channel', err);\r\n  }\r\n}\r\n"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,iBAAiB;;AAE1C;AACA;AACA,OAAO,SAASC,yBAAyBA,CAACC,MAAM,EAAEC,OAAO,EAAE;EACzD;EACA,MAAMC,MAAM,GAAGF,MAAM,GAAG,qBAAqBA,MAAM,EAAE,GAAG,EAAE;;EAE1D;EACA,MAAMG,OAAO,GAAGL,QAAQ,CAACK,OAAO,CAAC,yBAAyB,CAAC;EAE3D,MAAMC,KAAK,GAAG,wBAAwB;EAEtCD,OAAO,CAACE,EAAE,CACR,kBAAkB,EAClB;IAAEC,KAAK,EAAE,QAAQ;IAAEC,MAAM,EAAE,QAAQ;IAAEC,KAAK,EAAE;EAAkB,CAAC,EAC9DC,OAAO,IAAK;IACX;IACA,MAAMC,MAAM,GAAGD,OAAO,CAACE,GAAG,IAAIF,OAAO,CAACC,MAAM,IAAID,OAAO;IACvD,IAAIT,MAAM,EAAE;MACV,MAAMY,MAAM,GAAGF,MAAM,CAACG,cAAc;MACpC,IAAID,MAAM,IAAIA,MAAM,KAAKZ,MAAM,EAAE,OAAO,CAAC;IAC3C;IACAC,OAAO,CAACS,MAAM,CAAC;EACjB,CACF,CAAC,CAACI,SAAS,CAAC,CAAC;EAEb,OAAOX,OAAO;AAChB;AAEA,OAAO,SAASY,mBAAmBA,CAACZ,OAAO,EAAE;EAC3C,IAAI,CAACA,OAAO,EAAE;EACd,IAAI;IACFL,QAAQ,CAACkB,aAAa,CAACb,OAAO,CAAC;EACjC,CAAC,CAAC,OAAOc,GAAG,EAAE;IACZC,OAAO,CAACC,IAAI,CAAC,iCAAiC,EAAEF,GAAG,CAAC;EACtD;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}